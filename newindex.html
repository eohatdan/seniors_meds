<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spanish-English Flashcards</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js" defer></script>
</head>
<body>

<h2>Spanish-English Flashcards</h2>

<div id="flashcard">Loading...</div>

<div>
  <button onclick="flipCard()">ğŸ”„ Flip</button>
  <button onclick="markWrong()">âŒ Wrong</button>
  <button onclick="nextCard()">â¡ï¸ Next</button>
</div>

<hr>

<h3>Add New Phrase</h3>
<input id="newSpanish" placeholder="Spanish phrase" />
<input id="newEnglish" placeholder="English translation" />
<br>
<button onclick="addNewPhrase()">ğŸ’¾ Save Phrase</button>

<hr>
<button onclick="window.location.href='stats.html'">ğŸ“Š Show Statistics</button>
<button onclick="resetStats()">ğŸ”„ Reset Statistics</button>

<script>
  const SUPABASE_URL = 'https://ixxzxenspwzrkiazepbj.supabase.co'; // Replace with real value
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4eHp4ZW5zcHd6cmtpYXplcGJqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM1MzE1NjMsImV4cCI6MjA1OTEwNzU2M30.28E41uParU4YMisV-Kxlq1KybbOdRrbKqXYKrH84COw'; // Replace with real key

  let supabase;
  let phrases = [];
  let currentIndex = 0;
  let showingSpanish = true;
  let answeredCorrectly = true;

  function loadStats() {
    return JSON.parse(localStorage.getItem('flashcardStats') || '{"correct": 0, "attempts": 0}');
  }

  function saveStats(stats) {
    localStorage.setItem('flashcardStats', JSON.stringify(stats));
  }

  function resetStats() {
    saveStats({ correct: 0, attempts: 0 });
    alert("âœ… Statistics reset.");
  }

  async function loadPhrases() {
    const { data, error } = await supabase.from('Spanish_phrases').select('Spanish, English');
    if (error) {
      console.error(error);
      document.getElementById('flashcard').innerText = "Failed to load phrases.";
      return;
    }
    phrases = data.map(p => ({ spanish: p.Spanish, english: p.English }));
    if (phrases.length) displayCard();
  }

  function displayCard() {
    const phrase = phrases[currentIndex];
    document.getElementById('flashcard').innerText = showingSpanish ? phrase.spanish : phrase.english;
  }

  function flipCard() {
    showingSpanish = !showingSpanish;
    displayCard();
  }

  function markWrong() {
    answeredCorrectly = false;
  }

  function nextCard() {
    const stats = loadStats();
    stats.attempts += 1;
    if (answeredCorrectly) stats.correct += 1;
    saveStats(stats);
    answeredCorrectly = true;
    currentIndex = (currentIndex + 1) % phrases.length;
    showingSpanish = true;
    displayCard();
  }

  async function addNewPhrase() {
    const spanish = document.getElementById('newSpanish').value.trim();
    const english = document.getElementById('newEnglish').value.trim();
    if (!spanish || !english) return alert("Please enter both phrases.");

    const { error } = await supabase.from('Spanish_phrases').insert([{ Spanish: spanish, English: english }]);
    if (error) return alert("Error adding phrase.");
    document.getElementById('newSpanish').value = '';
    document.getElementById('newEnglish').value = '';
    alert("Phrase added.");
    loadPhrases();
  }

  document.addEventListener('DOMContentLoaded', () => {
    const wait = setInterval(() => {
      if (window.supabase) {
        clearInterval(wait);
        supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        loadPhrases();
      }
    }, 50);
  });
</script>

</body>
</html>
